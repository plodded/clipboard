---
stepsCompleted: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]
inputDocuments:
  - docs/index.md
  - docs/project-overview.md
  - docs/architecture.md
  - docs/component-inventory.md
  - docs/source-tree-analysis.md
documentCounts:
  briefs: 0
  research: 0
  brainstorming: 0
  projectDocs: 5
workflowType: 'prd'
lastStep: 11
project_name: 'MacPaste'
user_name: 'Boss'
date: '2025-12-24'
---

# Product Requirements Document - MacPaste

**Author:** Boss
**Date:** 2025-12-24

## Executive Summary

MacPaste 是一款 macOS 剪贴板管理器，旨在提供轻量级、快速呼出的剪贴板历史管理体验。当前项目处于 UI 原型阶段，前端界面和交互逻辑已完成，本 PRD 定义将原型推进到功能完整的 MVP 版本所需的核心功能开发。

**MVP 核心目标：** 将现有 UI 原型与 Rust 后端完整集成，实现真实的剪贴板监听、存储和管理功能，并通过 macOS 原生窗口管理提供类 Spotlight 的无缝用户体验。

### What Makes This Special

MacPaste 的独特价值在于其**轻量无感**的设计理念：

1. **类 Spotlight 体验** - 全局快捷键一键呼出，用完即走，不打断工作流
2. **系统级集成** - NSPanel 无边框面板不被 Dock 遮挡，始终可访问
3. **后台静默运行** - Dock 不显示，通过系统托盘管理，不占用 Dock 空间
4. **快速高效** - Rust 后端确保高性能剪贴板监听和数据处理

**核心体验：** 用户专注于当前任务，需要时 `Cmd+Shift+V` 一键呼出历史面板，快速选择并粘贴，面板自动消失，全程不打断思路。

## Project Classification

| 分类项 | 值 |
|--------|-----|
| **技术类型** | desktop_app |
| **领域** | general (通用工具) |
| **复杂度** | 中等 |
| **项目上下文** | 棕地项目 - 扩展现有系统 |

**技术栈（已确立）：**
- 前端：React 19 + TypeScript 5.7 + Vite 6 + TailwindCSS
- 后端：Rust (Edition 2021) + Tauri 2.x
- 架构：Tauri IPC 桌面应用

**MVP 范围聚焦：**
本 PRD 专注于从 UI 原型到功能完整 MVP 的关键路径，包括后端核心功能实现和 macOS 原生窗口管理集成，不涉及新 UI 功能的添加。

## User Journeys

### Journey 1: 快速粘贴 - 开发者的无缝工作流

小明是一名全栈开发者，正在为客户构建一个电商网站。他需要频繁地在不同文件间复制代码片段、API 密钥和配置参数。以前，他经常因为复制了新内容而丢失之前复制的重要代码，不得不重新打开文件查找。

今天，小明正在调试一个支付集成问题。他先复制了 Stripe 的 API 密钥，然后复制了一段错误日志，接着又复制了一个 Stack Overflow 上的解决方案代码。当他需要粘贴 API 密钥时，按下 `Cmd+Shift+V`，一个简洁的面板瞬间出现在屏幕中央，不遮挡他的代码编辑器。

他看到最近复制的三个项目整齐排列，用方向键快速定位到 API 密钥，按下回车，内容立即粘贴到光标位置，面板自动消失。整个过程不到 2 秒，他的思路完全没有被打断。

**这个旅程揭示的功能需求：**
- 全局快捷键 `Cmd+Shift+V` 呼出面板
- NSPanel 无边框窗口，不遮挡当前工作
- 剪贴板历史实时捕获和显示
- 键盘导航（方向键选择、回车确认）
- 选中后自动粘贴并关闭面板

### Journey 2: 搜索历史 - 找回遗失的灵感

小红是一名产品经理，正在撰写季度规划文档。三天前，她在浏览竞品分析报告时复制了一段精彩的市场洞察，当时打算用在今天的报告里。但这几天她复制了太多内容，那段文字早已被"淹没"在剪贴板历史中。

她按下 `Cmd+Shift+V` 呼出 MacPaste 面板，在搜索框中输入"市场份额"。面板立即过滤出包含这个关键词的历史记录，她看到了三天前复制的那段分析文字，还能看到是从哪个应用复制的（Chrome）。她用方向键选中，按回车，内容完美粘贴到她的文档中。

小红感叹："再也不用担心复制的重要内容找不到了。"

**这个旅程揭示的功能需求：**
- 搜索框支持关键词过滤
- 剪贴板历史持久化存储（跨会话保留）
- 显示来源应用元数据
- 搜索结果实时过滤
- 支持长期历史记录（至少数天）

### Journey Requirements Summary

| 能力领域 | 需求 |
|----------|------|
| **剪贴板监听** | 后台实时捕获所有复制内容 |
| **数据存储** | SQLite 持久化，支持跨会话历史 |
| **快捷键** | 全局 `Cmd+Shift+V` 注册和响应 |
| **窗口管理** | NSPanel 无边框面板，不被 Dock 遮挡 |
| **搜索过滤** | 关键词实时搜索历史记录 |
| **键盘导航** | 方向键选择 + 回车确认 + Esc 关闭 |
| **元数据** | 记录来源应用、时间戳 |

## Desktop App Specific Requirements

### Project-Type Overview

MacPaste 是一款 macOS 原生桌面应用，使用 Tauri 2.x 框架构建。项目充分利用 macOS 原生特性（NSPanel、系统托盘、全局快捷键）提供类 Spotlight 的剪贴板管理体验。

| 特性 | 说明 |
|------|------|
| **目标平台** | macOS（仅限） |
| **框架** | Tauri 2.x |
| **原生集成** | NSPanel、系统托盘、全局快捷键 |
| **网络依赖** | 无（完全离线） |

### Platform Support

| 平台 | 支持状态 | 说明 |
|------|----------|------|
| **macOS** | ✅ 支持 | 主要目标平台，使用原生 API |
| **Windows** | ❌ 不支持 | 不在 MVP 范围 |
| **Linux** | ❌ 不支持 | 不在 MVP 范围 |

**macOS 版本要求：**
- 最低支持版本：macOS 12 (Monterey) 或更高

### System Integration

MacPaste 需要深度集成 macOS 系统功能：

| 集成点 | 技术实现 | 说明 |
|--------|----------|------|
| **剪贴板监听** | NSPasteboard / Rust crate | 后台实时监听系统剪贴板变化 |
| **全局快捷键** | Tauri Global Shortcut API | 注册 `Cmd+Shift+V` 全局热键 |
| **NSPanel 窗口** | macOS 原生 API / Tauri 插件 | 无边框面板，不被 Dock 遮挡 |
| **系统托盘** | Tauri System Tray API | 菜单栏图标，显示/隐藏、退出 |
| **Dock 隐藏** | setDockVisibility API | Tauri v2 内置 API，动态控制 Dock 图标可见性 |

### Offline Capabilities

| 能力 | 说明 |
|------|------|
| **完全离线** | 应用无需网络连接即可正常运行 |
| **本地存储** | 所有数据存储在本地 SQLite 数据库 |
| **无云同步** | MVP 不包含云同步功能 |

### Data Storage Strategy

| 配置项 | MVP 策略 |
|--------|----------|
| **存储方式** | SQLite 本地数据库 |
| **历史限制** | 无限制（MVP 阶段） |
| **数据位置** | Tauri 应用数据目录 |
| **敏感数据** | 不做特殊处理（MVP 阶段） |

### Update Strategy

| 配置项 | MVP 策略 |
|--------|----------|
| **自动更新** | ❌ 不支持 |
| **更新方式** | 用户手动下载新版本 |
| **版本检查** | 不包含 |

### MVP Exclusions (Future Considerations)

以下功能不在 MVP 范围，可作为后续版本考虑：

| 功能 | 状态 | 说明 |
|------|------|------|
| 开机自启动 | 🔮 Future | 登录时自动启动 |
| 自动更新 | 🔮 Future | 应用内检查和更新 |
| 敏感数据过滤 | 🔮 Future | 排除密码管理器等 |
| 历史记录清理 | 🔮 Future | 自动清理旧记录 |
| 跨平台支持 | 🔮 Future | Windows/Linux 版本 |

## Project Scoping & Phased Development

### MVP Strategy & Philosophy

**MVP 类型：** 体验型 MVP（Experience MVP）
**核心理念：** 交付完整的"类 Spotlight 剪贴板管理"体验，功能精简但体验完整
**开发模式：** 个人/小团队项目，快速迭代

### MVP Feature Set (Phase 1)

**支持的核心用户旅程：**
- ✅ Journey 1: 快速粘贴 - 开发者的无缝工作流
- ✅ Journey 2: 搜索历史 - 找回遗失的灵感

**必须具备的能力：**

| 功能模块 | 具体功能 | 优先级 |
|----------|----------|--------|
| **剪贴板核心** | Rust 后端监听系统剪贴板变化 | P0 |
| **剪贴板核心** | 支持文本、RTF、图片、文件类型 | P0 |
| **剪贴板核心** | 写入选中内容到系统剪贴板 | P0 |
| **数据存储** | SQLite 持久化存储历史记录 | P0 |
| **数据存储** | 记录来源应用、时间戳元数据 | P0 |
| **窗口管理** | NSPanel 无边框面板实现 | P0 |
| **窗口管理** | 面板不被 Dock 遮挡 | P0 |
| **快捷键** | 全局 `Cmd+Shift+V` 注册和响应 | P0 |
| **系统集成** | 系统托盘（显示/隐藏、退出） | P0 |
| **系统集成** | Dock 不显示应用图标 | P0 |
| **UI 交互** | 键盘导航（方向键、回车、Esc） | P0 |
| **UI 交互** | 搜索框关键词过滤 | P0 |
| **UI 交互** | 图片本地预览 | P1 |
| **UI 交互** | 收藏功能 | P1 |

### Post-MVP Features

**Phase 2（增强版）：**

| 功能 | 说明 |
|------|------|
| 开机自启动 | 登录时自动启动应用 |
| 历史记录管理 | 自动清理旧记录、设置保留天数/条数 |
| 快捷键自定义 | 用户可配置呼出快捷键 |
| 敏感数据过滤 | 排除密码管理器等应用的复制内容 |

**Phase 3（扩展版）：**

| 功能 | 说明 |
|------|------|
| 自动更新 | 应用内检查和下载更新 |
| iCloud 同步 | 跨设备剪贴板历史同步 |
| 快捷短语 | 预设常用文本片段 |
| 跨平台支持 | Windows/Linux 版本 |

### Risk Mitigation Strategy

| 风险类型 | 风险描述 | 缓解策略 |
|----------|----------|----------|
| **技术风险** | NSPanel 在 Tauri 中的实现复杂度 | 先研究 Tauri 插件生态，必要时使用原生 Swift 桥接 |
| **技术风险** | 剪贴板监听的性能和稳定性 | 使用成熟的 Rust crate，参考 clipboard-rs 等 |
| **体验风险** | 快捷键被其他应用占用 | 提供快捷键自定义作为 Phase 2 功能 |
| **资源风险** | 开发时间超预期 | 严格控制 MVP 范围，P1 功能可延后 |

## Functional Requirements

### 剪贴板管理

- **FR1:** 系统可以后台监听 macOS 剪贴板变化并自动捕获新内容
- **FR2:** 系统可以捕获纯文本类型的剪贴板内容
- **FR3:** 系统可以捕获富文本（RTF）类型的剪贴板内容
- **FR4:** 系统可以捕获图片类型的剪贴板内容
- **FR5:** 系统可以捕获文件引用类型的剪贴板内容
- **FR6:** 用户可以选择历史记录项并将其写入系统剪贴板
- **FR7:** 用户可以选择历史记录项后自动粘贴到当前活跃应用

### 数据存储与检索

- **FR8:** 系统可以持久化存储剪贴板历史记录，跨应用会话保留
- **FR9:** 系统可以为每条历史记录保存来源应用信息
- **FR10:** 系统可以为每条历史记录保存捕获时间戳
- **FR11:** 用户可以通过关键词搜索历史记录内容
- **FR12:** 用户可以按内容类型（文本/图片/文件）过滤历史记录
- **FR13:** 用户可以查看收藏的历史记录

### 收藏管理

- **FR14:** 用户可以将历史记录项标记为收藏
- **FR15:** 用户可以取消历史记录项的收藏标记

### 窗口管理

- **FR16:** 系统可以显示无边框浮动面板（NSPanel）
- **FR17:** 面板显示时不被 Dock 栏遮挡
- **FR18:** 用户可以通过快捷键切换面板的显示/隐藏状态
- **FR19:** 用户可以通过 Esc 键关闭面板
- **FR20:** 面板在用户选择项目后自动关闭

### 快捷键与导航

- **FR21:** 用户可以通过全局快捷键 `Cmd+Shift+V` 呼出面板
- **FR22:** 用户可以使用左右方向键在历史记录项之间导航
- **FR23:** 用户可以使用回车键确认选择当前项
- **FR24:** 系统可以高亮显示当前选中的历史记录项

### 系统集成

- **FR25:** 系统可以在 macOS 菜单栏显示托盘图标
- **FR26:** 用户可以通过托盘菜单切换面板显示/隐藏
- **FR27:** 用户可以通过托盘菜单退出应用
- **FR28:** 应用运行时不在 Dock 栏显示图标

### 内容展示

- **FR29:** 系统可以显示历史记录的内容预览
- **FR30:** 系统可以显示历史记录的内容类型图标
- **FR31:** 系统可以显示历史记录的时间戳（相对时间格式）
- **FR32:** 系统可以显示图片类型记录的缩略图预览
- **FR33:** 系统可以显示历史记录的收藏状态
